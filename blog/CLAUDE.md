# CLAUDE.md - Blog Project

This file provides guidance to Claude Code when working with the blog project at `badyass.xyz/blog`.

## Project Overview

The blog is a lightweight Vue 3 application that serves as a personal content hub at `badyass.xyz/blog`. It displays a curated list of personal publications, projects, write-ups, and poems organized into sections. The application is configuration-driven, pulling content from a JSON file with no hardcoded content in the source code.

## Project Structure

```
/blog/
├── src/
│   ├── main.js              # Vue app entry point, creates app and mounts to #app
│   └── App.vue              # Root component (currently minimal)
├── public/
├── dist/                    # Built output (generated by Vite build)
├── index.html               # HTML entry point with Simple Analytics integration
├── package.json             # Dependencies and npm scripts
├── package-lock.json        # Locked dependency versions
├── vite.config.js           # Vite build configuration
├── eslint.config.js         # ESLint configuration for Vue/JS/TS
├── .prettierrc              # Prettier code formatting rules
├── deploy.sh                # Deployment script (builds and deploys via SCP)
├── ROUGH_PLAN.md            # Original design plan for the blog
└── .claude/
    └── settings.local.json  # Claude Code local settings
```

## Content Structure

The blog content needs to be defined.

### Content Types

Write ups, both tecnical and artistic.

### Adding New Content

TBD

## Development Commands

All commands should be run from the `blog/` directory:

```bash
cd blog
```

### Install Dependencies

```bash
npm install
```

Installs dependencies specified in package.json (Vue 3, Vite, ESLint, Prettier, etc.)

### Development Server

```bash
npm run dev
```

Starts Vite dev server with hot module replacement (HMR). Typically runs at `http://localhost:5173`. Changes to source files and content.json are reflected instantly.

### Production Build

```bash
npm run build
```

Creates optimized production build in `dist/` directory. Vite handles:
- Vue component compilation
- JavaScript minification and tree-shaking
- CSS optimization
- Asset hashing for cache busting

Output structure:
```
dist/
├── index.html          # Compiled HTML
└── assets/             # Minified JS/CSS bundles with hash names
```

### Preview Build

```bash
npm run preview
```

Locally serves the production build from `dist/` directory to verify it works correctly before deploying.

### Deploy to Server

```bash
npm run deploy
```

Runs `deploy.sh` which:
1. Builds the project with `npm run build`
2. Creates timestamped directory on remote server: `/var/www/badyass.xyz/blog-${timestamp}/`
3. Uploads all files from `dist/` via SCP
4. Updates symlink `/var/www/badyass.xyz/blog` to point to the new deployment
5. Keeps old deployments for easy rollback

Requires SSH key configured in `~/.ssh/` for authentication to `167.71.143.97`

### Code Quality

```bash
npm run lint              # Check for ESLint violations
npm run lint:fix         # Auto-fix ESLint violations
npm run format           # Format code with Prettier
npm run format:check     # Check if code matches Prettier format
```

## Architecture

### Application Flow

1. **Entry Point** (`index.html`):
   - Mounts Vue app to `<div id="app">`
   - Includes Simple Analytics script for analytics tracking
   - Loads `/src/main.js` as module

2. **Initialization** (`src/main.js`):
   - Creates Vue app instance
   - Imports `style.css` (global styles)
   - Imports and mounts `App.vue` to the DOM

3. **Root Component** (`src/App.vue`):
   - Currently minimal with empty container
   - Design plan indicates it should:
     - Fetch content from `content.json`
     - Distribute data to child components
     - Render header, social links, project cards, etc.

4. **Static Content**:
   - All blog content served from `public/content.json`
   - Loaded at runtime by the application
   - Updates don't require code changes or rebuilds

### Build System

- **Bundler**: Vite 7.x
  - Fast dev server with HMR
  - Optimized production builds
  - Native ES module support
  - Automatic dependency pre-bundling

- **Framework**: Vue 3 (Composition API)
  - Modern reactive framework
  - `<script setup>` syntax
  - Single-file components (.vue)

- **CSS**: No dedicated preprocessing (raw CSS or inline styles)
  - CSS variables for theming (planned)
  - Responsive design (planned)

### Planned Features (from ROUGH_PLAN.md)

1. **Article Display**:
   - Grid or list of articles/publications by date
   - Individual article pages with markdown-to-HTML rendering
   - Markdown support for writing posts

2. **Styling**:
   - Match existing badyass.xyz home page style
   - Dark theme consistency
   - Responsive mobile design

3. **Image Handling**:
   - Support for inline, left-aligned, right-aligned images
   - Custom image display options with syntax like `![caption](url){inline, left/right}`

## Key Dependencies

### Production
- **vue** (^3.5.23): Progressive JavaScript framework for reactive UI

### Development
- **vite** (^7.2.1): Next-generation frontend build tool with fast dev server
- **@vitejs/plugin-vue** (^6.0.1): Official Vite plugin for Vue 3 SFC support
- **eslint** (^9.39.1): JavaScript linter for code quality
- **eslint-plugin-vue** (^10.5.1): Vue-specific ESLint rules
- **@typescript-eslint/eslint-plugin** (^8.46.3): TypeScript support in ESLint
- **@typescript-eslint/parser** (^8.46.3): TypeScript parser for ESLint
- **typescript-eslint** (^8.46.3): Combined TypeScript ESLint rules
- **prettier** (^3.6.2): Code formatter for consistency
- **eslint-config-prettier** (^10.1.8): Disables ESLint rules that conflict with Prettier

## Configuration Files

### vite.config.js

Minimal Vite configuration:
```javascript
export default defineConfig({
  plugins: [vue()],           // Enable Vue 3 SFC support
  base: '/',                  // Serve from root (not /blog)
  build: {
    outDir: 'dist',           // Output directory
    assetsDir: 'assets'       // Assets subdirectory
  }
})
```

**Note**: The `base: '/'` setting assumes the blog will be served at the root domain or handled by a reverse proxy. If serving at `/blog/`, this should be changed to `base: '/blog/'`.

### eslint.config.js

Flat ESLint configuration with:
- JavaScript recommended rules
- TypeScript rules
- Vue 3 recommended rules
- Prettier compatibility
- Global environment variables (console, fetch, window, document)
- Custom rules:
  - Multi-word component names allowed
  - No v-html warnings (only warnings)
  - Default props not required
  - Unused variable warnings (ignore leading underscore)
  - Console warnings allowed for warn/error

Ignored patterns:
- `dist/` and `node_modules/`
- Config files

### .prettierrc

Code formatting rules:
```json
{
  "semi": false,              // No semicolons
  "singleQuote": true,        // Use single quotes
  "tabWidth": 2,              // 2-space indentation
  "trailingComma": "none",    // No trailing commas
  "printWidth": 100,          // 100 character line limit
  "arrowParens": "avoid",     // Omit parens in arrow functions
  "endOfLine": "lf"           // Unix line endings
}
```

## Deployment Architecture

### Blue-Green Deployment Pattern

The blog uses a blue-green style deployment strategy for zero-downtime updates:

1. **Build Phase** (local or CI):
   ```bash
   npm run build  # Creates dist/ directory
   ```

2. **Deploy Phase** (via deploy.sh):
   ```bash
   # Create timestamped directory on server
   ssh root@167.71.143.97 "mkdir -p /var/www/badyass.xyz/blog-${timestamp}"
   
   # Upload built files via SCP
   scp -r dist/* root@167.71.143.97:/var/www/badyass.xyz/blog-${timestamp}/
   
   # Update symlink atomically
   ssh root@167.71.143.97 "ln -s /var/www/badyass.xyz/blog-${timestamp} /var/www/badyass.xyz/blog"
   ```

3. **Server Structure**:
   ```
   /var/www/badyass.xyz/
   ├── blog -> blog-1234567890/      # Symlink to current deployment
   ├── blog-1234567890/              # Previous deployment (for rollback)
   └── blog-1234567891/              # Current deployment
   ```

### Advantages
- **Zero-downtime deployments**: Symlink switch is atomic
- **Easy rollback**: Symlink can point to previous version
- **Safe builds**: Old deployments preserved for debugging
- **No service restart**: Web server continues serving during deploy

### Server Configuration

- **Address**: `167.71.143.97`
- **User**: `root` (via SSH key)
- **Base Path**: `/var/www/badyass.xyz/`
- **Symlink**: `/var/www/badyass.xyz/blog` (served at `/blog` or root depending on nginx/apache config)

## CI/CD Integration

The blog project currently has **no GitHub Actions workflow**. CI/CD workflows exist for the home and facet projects but not for the blog.

### To Add CI/CD for Blog

Create `.github/workflows/deploy-blog.yml`:

```yaml
name: Deploy Blog

on:
  push:
    branches:
      - main
    paths:
      - blog/**

jobs:
  deploy:
    name: Deploy Blog
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: 'blog/package-lock.json'

      - name: Set up SSH
        uses: webfactory/ssh-agent@a6f90b1f127823b31d4d4a8d96047790581349bd
        with:
          ssh-private-key: ${{ secrets.SSH_DEPLOY_KEY }}

      - name: Add server to known hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H 167.71.143.97 >> ~/.ssh/known_hosts

      - name: Deploy Blog
        run: |
          cd blog
          npm ci
          npm run build
          npm run deploy
```

## Debugging

### Development Mode

```bash
npm run dev
```

Vite provides:
- Full source maps for debugging
- HMR (Hot Module Replacement) for instant updates
- Browser DevTools support

### Build Issues

```bash
npm run build
npm run preview
```

Use preview to test production build locally before deploying.

### Linting Issues

```bash
npm run lint           # Show violations
npm run lint:fix      # Auto-fix violations
npm run format:check  # Check formatting
npm run format        # Auto-format code
```

## Notes for Future Claude Instances

1. **App.vue is minimal**: The current App.vue is nearly empty. Per ROUGH_PLAN.md, it should fetch `content.json` and render content using child components.

2. **No style.css imported**: The import of `style.css` in `main.js` references a file that doesn't exist. This should either be created or removed.

3. **Vite base configuration**: Current `base: '/'` assumes root serving. If the blog is truly at `/blog/`, the vite.config.js needs `base: '/blog/'`.

4. **Missing CI/CD**: Consider adding a `deploy-blog.yml` GitHub Action following the same pattern as deploy-home.yml and deploy-facet.yml.

5. **Content-driven design**: The beauty of this architecture is that content updates don't require code changes. Leverage this when adding features.

6. **Analytics enabled**: Simple Analytics is integrated via `<script>` tag in index.html. Check dashboard for traffic data.

## Related Projects

This blog is part of a larger monorepo:
- **`/home/`**: Personal intro page (Vue 3 + Vite)
- **`/facet/`**: 3D image tiler (Three.js + Webpack)
- **`/footble/`**: Football player guessing game (Vue 3)

All projects share similar deployment patterns via blue-green style versioning.
